cothread_VERSION ?= 2.12

TAR_EXTENSION = .tar.gz
MD5_SUM_2.12 = 4021d7bbfc459eeeb7966e3bf0a3f5ce


O-install = $(O)/install

PYTHON_SETUP_ENV = \
    CC=$(COMPILER_PREFIX)-gcc \
    LDSHARED="$(COMPILER_PREFIX)-gcc -shared" \
    _python_sysroot=$(LIB_PREFIX) \
    _python_prefix=/usr \
    _python_exec_prefix=/usr


build:
	cd $(srcdir)  && \
        $(PYTHON_SETUP_ENV) python2 setup.py build -b $O \
            install --prefix=$(O-install)/usr

        # Post installation cleanup
ifeq ($(PYTHON_PYC_ONLY),1)
	find $(O-install)/usr/lib/python2.7 -name '*.py' -exec rm -f {} +
endif

        # Strictly this belongs elsewhere, but if requested install EPICS libs
ifdef EPICS_BASE
	cp -a $(EPICS_BASE)/lib/$(EPICS_ARCH)/*.so* $(LIB_PREFIX)/usr/lib
endif


install:
	tar c -C $(O-install) . | tar x -C $(sysroot)

        # Catools needs libca.so, and it will help to have caRepeater available.
        # It so happens that caRepeater pulls in libca.so
ifdef EPICS_BASE
	$(install) -x $(EPICS_BASE)/bin/$(EPICS_ARCH)/caRepeater /usr/bin
endif


# vim: set filetype=make:
