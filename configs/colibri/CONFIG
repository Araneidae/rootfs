# Definitions for Toradex Colibri board: ARM PXA-270 processor.

TOOLCHAIN_VERSION = gcc-4.3.2-glibc-2.7
COMPILER_PREFIX = arm-xscale-linux-gnueabi

ROOTFS_VERSION = DLS Colibri version 0.0.

KERNEL_NAME = uImage-colibri
KERNEL_ADDR = a0001000
MKIMAGE = /dls_sw/targetOS/u-boot/colibri/mkimage
CONSOLE_BAUD = 9600
CONSOLE_TTY = ttyS0
BOOTARGS = $$bootargs
QUOTE_BOOTARGS = 1

ROOT_PASSWORD = Jungle

SSH_AUTHORIZED_KEYS = $(configdir)/authorized_keys

CFLAGS = -O2 -mthumb
CFLAGS_dropbear = -O2

TERMS = xterm xterm-color screen vt100 vt102

LDCONFIG = cross


# This one is essential, nothing builds without it.
EXTRAS += busybox
# Components required for normal operation.
EXTRAS += ntp dropbear portmap
# Useful debugging tools
EXTRAS += strace lsof
# Useful
EXTRAS += nano mtd-utils

# Miscellaneous extra components of variable utility.
# EXTRAS += nano bash screen mtd-utils sudo
# EXTRAS += procinfo procinfo-ng
# EXTRAS += testing

# Alternative lightweight NTP clients.
# EXTRAS += openntpd
# EXTRAS += ntpclient

BOOT = initramfs
# BOOT = nfs
# BOOT = jffs2

TFTP_SERVER = serv3:/tftpboot


# Network installation: this determines how the network is configured.
NETWORK = mtd

# The following are relevant if NETWORK != mtd above.
NW_HOSTNAME = colibri
NW_ADDRESS = 172.23.252.21
NW_NETMASK = 255.255.240.0
NW_GATEWAY = 172.23.240.254


final-install::
        # Install the regular nfs mounts.
	mkdir -p $(patsubst %,$(sysroot)/mnt/%,nfs prod work)
	cat $(configdir)/fstab >>$(sysroot)/etc/fstab

ifeq ($(DEVELOPMENT),y)
DROPBEAR_KEYS = y
endif


# The following is the u-boot environment associated with this installation:
#
# bootdelay=5
# baudrate=9600
# ethaddr=00:14:2d:20:04:7a
# pxaspeed=0x00000670
# gatewayip=172.23.240.254
# netmask=255.255.240.0
# serverip=172.23.240.3
# bootargs=console=ttyS0,9600n8
# hostname=colibri4
# ipaddr=172.23.252.19
# stdin=serial
# stdout=serial
# stderr=serial
# bootcmd=tftpboot a0000000 boot-script-colibri.image && autoscr a0000000
#
# Here the hostname and ipaddr value vary, but the rest are constant between
# different processors.
