TOP = $(CURDIR)/..
include COMMON


IMAGE_NAME = imagefile-$(TARGET).cpio.gz

EXPORTS = \
    KERNEL_NAME KERNEL_ADDR \
    BOOTARGS QUOTE_BOOTARGS \
    IMAGE_NAME IMAGE_ADDR


$(O)imagefile.cpio.gz: $(O)imagefile.cpio
	gzip -c -1 $< >$@

$(O)boot-script: $(O)imagefile.cpio.gz
	$(call EXPORT,$(EXPORTS)) ./make-boot-script $@ $<

default: $(O)imagefile.cpio.gz push-boot-script
	scp $< $(TFTP_SERVER)/$(IMAGE_NAME)
